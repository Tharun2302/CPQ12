<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microsoft Auth Debug</title>
</head>
<body>
    <h1>Microsoft Authentication Debug</h1>
    
    <div id="debug-info">
        <h2>Current Environment:</h2>
        <p><strong>Current URL:</strong> <span id="current-url"></span></p>
        <p><strong>Origin:</strong> <span id="origin"></span></p>
        <p><strong>Redirect URI:</strong> <span id="redirect-uri"></span></p>
        <p><strong>Client ID:</strong> <span id="client-id"></span></p>
        
        <h2>Test Microsoft Auth:</h2>
        <button onclick="testMicrosoftAuth()">Test Microsoft Authentication</button>
        
        <h2>Debug Info:</h2>
        <div id="debug-output"></div>
    </div>

    <script>
        // Display current environment info
        document.getElementById('current-url').textContent = window.location.href;
        document.getElementById('origin').textContent = window.location.origin;
        document.getElementById('redirect-uri').textContent = window.location.origin + '/auth/microsoft/callback';
        
        // Check if we're in a Vite environment
        const clientId = import.meta?.env?.VITE_MSAL_CLIENT_ID || 'e71e69a8-07fd-4110-8d77-9e4326027969';
        document.getElementById('client-id').textContent = clientId;
        
        function testMicrosoftAuth() {
            const debugOutput = document.getElementById('debug-output');
            debugOutput.innerHTML = '<p>Testing Microsoft authentication...</p>';
            
            // Test the auth URL
            const redirectUri = encodeURIComponent(window.location.origin + '/auth/microsoft/callback');
            const scopes = encodeURIComponent('openid profile email User.Read');
            const state = Math.random().toString(36).substring(2, 15);
            
            const authUrl = `https://login.microsoftonline.com/common/oauth2/v2.0/authorize?` +
                `client_id=${clientId}&` +
                `response_type=code&` +
                `redirect_uri=${redirectUri}&` +
                `scope=${scopes}&` +
                `response_mode=query&` +
                `state=${state}&` +
                `prompt=select_account`;
            
            debugOutput.innerHTML = `
                <h3>Generated Auth URL:</h3>
                <p><a href="${authUrl}" target="_blank">${authUrl}</a></p>
                <h3>Test Steps:</h3>
                <ol>
                    <li>Click the link above to test Microsoft login</li>
                    <li>Complete Microsoft authentication</li>
                    <li>Check if you're redirected to: ${window.location.origin}/auth/microsoft/callback</li>
                    <li>Check browser console for any errors</li>
                </ol>
            `;
        }
        
        // Check for URL parameters (in case we're on the callback page)
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('code')) {
            document.getElementById('debug-output').innerHTML = `
                <h3>âœ… Microsoft Callback Received!</h3>
                <p><strong>Code:</strong> ${urlParams.get('code')}</p>
                <p><strong>State:</strong> ${urlParams.get('state')}</p>
                <p><strong>Error:</strong> ${urlParams.get('error') || 'None'}</p>
            `;
        }
    </script>
</body>
</html>
